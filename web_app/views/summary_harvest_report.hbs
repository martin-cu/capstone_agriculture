

<style>
	table td {
		color: #332C1F;
	}

	@media print {
	body * {
		visibility: hidden;
	}

	.section-to-print, .section-to-print * {
		visibility: visible !important;
		color: #332C1F;
	}
	
	.section-to-print {
		position: absolute;
		width: 100%;
		left: 0;
		top: 0;
	}
	}

	#totalSummary td {
		background-color: #EEEEEE !important;
	}
</style>

<div class="container-fluid" style="color: #332C1F;">

<div class="d-sm-flex justify-content-between align-items-center mb-4">
    <h3 class="text-dark mb-0">Farm Productivity Reports</h3><a class="btn btn-primary disabled btn-sm d-none d-sm-inline-block" role="button" style="background: rgba(78,115,223,0);color: #332c1f;border-color: rgba(51,44,31,0);">&nbsp;<br>&nbsp;<i class="far fa-clock" style="margin-right: 5px;"></i>Date<br><br></a>
</div>

<div class="row">
<div class="col-lg-12 col-lg-12 col-xxl-12">

{{!-- CARD --}}
<div class="card shadow mb-4" style="max-width: 1150px; margin: 0px auto;">

{{!-- START CARD HEADER --}}
<div class="card-header d-flex justify-content-between align-items-center" style="background: #939C1F;color: #ffffff;">
                    
    <div class="col" style="max-width: 70px; padding-top: 2px">
        <button type="submit" class="btn btn-primary btn-md" id="back" onclick='window.location="/farm_productivity_report"'> <!-- Replaced the javascript back function because the page top function is also being considered in the window history -->
        	<i class="far fa-long-arrow-left d-lg-flex justify-content-lg-center" id="backIcon"></i>
        </button>        
    </div>

    <div class="col" style="margin-right: 650px; padding-top: 15px">
    	<h6>Detailed Harvest Report</h6> <!-- Change to handlebar later -->
    </div>

    <i class="fas fa-print" style="color: rgb(255,255,255);" value="print" id="print" type="button"></i>
</div>
{{!-- END CARD HEADER --}}

{{!-- START CARD BODY --}}
<div class="card-body" style="color: #332C1F;">

<div class="row">
<div class="col" style="padding-top: 5px;">

<div class="m-3">
	<!-- <div class="d-flex w-100">
		{{#each data.chart_data}}
		<div class="w-100 mx-3 border border-secondary d-flex flex-column rounded" style="max-width: 600px;">
			<div class="text-white w-100 px-3 py-2 text-center rounded-top bg-dark">
				Seed: {{this.title}}
			</div>
			<canvas id="{{this.title}}" class="px-3 py-3" style="max-width: 100% !important; max-height: 400px !important;"></canvas>	
		</div>
		{{/each}}
	</div> -->

	<div class="row">
		<div class="d-flex w-100">
			<div class="w-100 mx-3 border border-secondary d-flex flex-column rounded" style="max-width: 600px;">
				<div class="text-white w-100 px-3 py-2 text-center rounded-top bg-dark">
					Temperature (Avg)
				</div>
				<canvas id="Temperature" class="px-3 py-3" style="max-width: 100% !important; max-height: 400px !important;"></canvas>	
			</div>
			<div class="w-100 mx-3 border border-secondary d-flex flex-column rounded" style="max-width: 600px;">
				<div class="text-white w-100 px-3 py-2 text-center rounded-top bg-dark">
					Humidity (Avg)
				</div>
				<canvas id="Humidity" class="px-3 py-3" style="max-width: 100% !important; max-height: 400px !important;"></canvas>	
			</div>
		</div>

		<div class="d-flex w-100 mt-3">
			<div class="w-100 mx-3 border border-secondary d-flex flex-column rounded" style="max-width: 600px;">
				<div class="text-white w-100 px-3 py-2 text-center rounded-top bg-dark">
					Pressure (Avg)
				</div>
				<canvas id="Pressure" class="px-3 py-3" style="max-width: 100% !important; max-height: 400px !important;"></canvas>	
			</div>
			<div class="w-100 mx-3 border border-secondary d-flex flex-column rounded" style="max-width: 600px;">
				<div class="text-white w-100 px-3 py-2 text-center rounded-top bg-dark">
					Rainfall (Avg)
				</div>
				<canvas id="Rainfall" class="px-3 py-3" style="max-width: 100% !important; max-height: 400px !important;"></canvas>	
			</div>
		</div>
	</div>

	<div class="row">
        <div class="col">
            <div class="table-responsive">
                <table class="table">
                    {{#each data.printable}}
                		{{#if @first}}
                		<th class="text-left">Farm Name</th>
                        	<th class="text-left">Seed Name</th>
                            {{#each this.labels}}
                            <th class="text-center">{{this}}</th>
                            {{/each}}
                            {{/if}}

                    	{{#each this.datasets}}
                    	<tr>
                    		<td class="text-left">{{this.label}}</td>
                    		{{#if @first}}
                    		<td class="text-left align-middle" rowspan="{{../datasets.length}}">{{../title}}</td>

                    		{{/if}}
                    		{{#each this.data}}
                    		<td class="text-center">{{this}}</td>
                    		{{/each}}
                    	</tr>
                    	{{/each}}

                    {{/each}}
                </table>
            </div>
        </div>
    </div>


	<div class="row my-3">
		 <div style="font-weight: bold;">
		 	Summary
		 </div>
		 <div class="text-dark">{{data.overview}}</div>
	</div>

	<div class="row">
		<div class="col-12">
			<div style="width: auto;">
				<table class="table table-striped table-bordered tablesorter" id="ipi-table">
					<thead class="thead-dark">
						<tr style="background: #212529;">
							<th style="">Farm Name</th>
							<th style="">Seed Name</th>
							<th style="text-align:right" class="">Forecasted Yield </th>
							<th style="text-align:right">Actual Yield</th>
						</tr>
					</thead>
					<tbody aria-live="polite" aria-relevant="all">
					 	
						{{#each data.detailed_list }}
						<tr role="row">
							<td>{{this.farm_name}}</td>
							<td>{{this.seed_name}}</td>
							<td class="text-right">
								{{#if forecast}}
								{{this.forecast}} cavans/ha
								{{else}}
								N/A
								{{/if}}
							</td>
							<td class="text-right d-flex">
								<div class="ml-auto mr-3 d-flex">
									<div class="">{{this.harvested}} cavans/ha</div>
									<div class="ml-2 {{this.change.color}}">
										({{this.change.val}}%)
									</div>
								</div>
								
								<span>
									<div class="dropdown no-arrow" style="display:inline-block; float: right">
										<button id="more" class="btn btn-primary btn-sm dropdown-toggle dropdown no-arrow" aria-expanded="false" data-bs-toggle="dropdown" type="button">
											<i class="fa fa-ellipsis-h d-lg-flex justify-content-lg-center"></i>
										</button>
										<div class="dropdown-menu notSidebar shadow dropdown-menu-end animated--fade-in">
											<a class="dropdown-item notSidebar" href="/harvest_report/{{this.crop_plan}}/detailed?id={{this.calendar_id}}&farm={{this.farm_name}}">View Details</a>
										</div>
									</div>
								</span> 
							</td>

						</tr>
						{{/each}}

					   <!-- <tr role="row">
							<td> Farm Productivity Report</td>
							<td> October 1, 2021 - March 1, 2021</td>
							<td> Palay 2021 </td>
							<td> Ongoing
								<span>
								<div class="dropdown no-arrow" style="display:inline-block; float: right">
										<button id="more" class="btn btn-primary btn-sm dropdown-toggle dropdown no-arrow" aria-expanded="false" data-bs-toggle="dropdown" type="button">
											<i class="fa fa-ellipsis-h d-lg-flex justify-content-lg-center"></i>
										</button>
										<div class="dropdown-menu notSidebar shadow dropdown-menu-end animated--fade-in">
											<a class="dropdown-item notSidebar" href="/test_report">View Details</a>
											{{!-- <a class="dropdown-item notSidebar" href="#">&nbsp;Update</a>
											<div class="dropdown-divider"></div>
											<a class="dropdown-item notSidebar" href="#">&nbsp;Delete</a> --}}
										</div>
									</div>
								</span> 
							</td>
						</tr> -->
						<!-- <tr role="row">
							<td> Harvest Report</td>
							<td> October 1, 2021 - March 1, 2021</td>
							<td> Palay 2021 </td>
							<td> Completed
								<span>
								<div class="dropdown no-arrow" style="display:inline-block; float: right">
										<button id="more" class="btn btn-primary btn-sm dropdown-toggle dropdown no-arrow" aria-expanded="false" data-bs-toggle="dropdown" type="button">
											<i class="fa fa-ellipsis-h d-lg-flex justify-content-lg-center"></i>
										</button>
										<div class="dropdown-menu notSidebar shadow dropdown-menu-end animated--fade-in">
											<a class="dropdown-item notSidebar" href="/farms/work_order&id={{this.work_order_id}}">View Details</a>
											{{!-- <a class="dropdown-item notSidebar" href="#">&nbsp;Update</a>
											<div class="dropdown-divider"></div>
											<a class="dropdown-item notSidebar" href="#">&nbsp;Delete</a> --}}
										</div>
									</div>
								</span> 
							</td>
						</tr> -->
					</tbody>
				</table>
			</div>
				   {{!-- <nav class="float-right" style="margin-right: 10px;">
							<ul class="pagination">
								<li class="page-item"><a class="page-link" href="#" aria-label="Previous"><span aria-hidden="true">«</span></a></li>
								<li class="page-item"><a class="page-link" href="#">1</a></li>
								<li class="page-item"><a class="page-link" href="#">2</a></li>
								<li class="page-item"><a class="page-link" href="#">3</a></li>
								<li class="page-item"><a class="page-link" href="#">4</a></li>
								<li class="page-item"><a class="page-link" href="#">5</a></li>
								<li class="page-item"><a class="page-link" href="#" aria-label="Next"><span aria-hidden="true">»</span></a></li>
							</ul>
						</nav>        --}}
		</div>

								</div>
</div>

</div>
</div>

</div>
{{!-- END OF CARD BODY --}}

</div>

</div>
</div>

</div>

{{!-- PRINT HARVEST SUMMARY REPORT --}}
	<div class="section-to-print" style="display: none; visibility: hidden">
		<div class="container" style="margin-top: 10px;">

		{{!-- HEADER --}}
		<div class="row" style="margin-bottom: 20px;">
        <div class="col" style="background: #657429; padding: 20px">
            <div class="d-xxl-flex align-items-xxl-center">
				<center style="margin-bottom: 20px;">
					<img src="../../assets/img/LA_logo.png" style="width: 150px;margin-left: auto;margin-right: auto;">
				</center>
			</div>

            <div>
                <h1 style="text-align: center;font-size: 22px;color: #F1E8D7;margin-bottom: 0px;">LA Rice Mill</h1>
            </div>
            <div>
                <h1 style="text-align: center;font-size: 22px;color: #F1E8D7;margin-bottom: 0px;">Harvest Report</h1>
            </div>
            <div>
                <h1 style="text-align: center;font-size: 22px;color: #F1E8D7;margin-bottom: 8px;">For the Crop Cycle on October 2021 - March 2022</h1>
            </div>
        </div>
    	</div>
		{{!-- END OF HEADER --}}

    <div class="row">
        <div class="col" style="background-color:#212529;margin-top: 15px; height: auto">
            <h4 style="color:white; font-weight: bold; margin-bottom: 15px">Crop Plan Name</h4>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="table-responsive">
                <table class="table">
                    {{#each data.printable}}
                		{{#if @first}}
                		<th class="text-left">Farm Name</th>
                        	<th class="text-left">Seed Name</th>
                            {{#each this.labels}}
                            <th class="text-center">{{this}}</th>
                            {{/each}}
                            {{/if}}

                    	{{#each this.datasets}}
                    	<tr>
                    		<td class="text-left">{{this.label}}</td>
                    		{{#if @first}}
                    		<td class="text-left align-middle" rowspan="{{../datasets.length}}">{{../title}}</td>

                    		{{/if}}
                    		{{#each this.data}}
                    		<td class="text-center">{{this}}</td>
                    		{{/each}}
                    	</tr>
                    	{{/each}}

                    {{/each}}
                </table>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col" style="background-color: #EEEEEE;">
            <div class="table">
                <table class="table" id="totalSummary">
            
                    <tbody style="border-style: none;">
                        <tr style="border-style: none;">
                            <td style="width: 150px;border-style: none;padding: 0px;"></td>
                            <td style="text-align: left;width: 100px;border-style: none;font-weight: bold;">Average Harvested Crops</td>
                            <td style="text-align: right;width: 100px;border-style: none;font-weight: bold; padding-right: 5px">{{data.printable.avg}} cavans/ha</td>
                        </tr>
                        <tr style="border-style: none;font-weight: bold;">
                            <td style="width: 150px;border-style: none;padding: 0px;font-weight: bold;"></td>
                            <td style="text-align: left;width: 100px;border-style: none;font-weight: bold;">Total Harvested Crops</td>
                            <td style="text-align: right;width: 100px;border-style: none;font-weight: bold; padding-right: 5px">{{data.printable.total_harvest}} cavans/ha</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
		</div>

	</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.2/chart.min.js" integrity="sha512-tMabqarPtykgDtdtSqCL3uLVM0gS1ZkUAVhRFu1vSEFgvB73niFQWJuvviDyBGBH22Lcau4rHB5p2K2T0Xvr6Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript">
	// var obj = {{{data.json_chart_data}}};
	// console.log(obj);
	var env_obj = {{{data.env_chart}}};
	console.log(env_obj);
	var default_opt = {
			legend: {
			position: 'bottom',
			},
			title: {
			display: true,
			text: 'Chart Title'
			},
			scale: {
			ticks: {
			beginAtZero: true
			}
			},
			tooltips:{
			enabled:false,
			callbacks:{
				label: function(tooltipItem, data){
				var datasetLabel = data.datasets[tooltipItem.datasetIndex].label || '';
				//This will be the tooltip.body
				return datasetLabel + ': ' + tooltipItem.yLabel +': '+ data.datasets[tooltipItem.datasetIndex].notes[tooltipItem.index];
			}
			},
			custom: function(tooltip){
			// Tooltip Element
			var tooltipEl = document.getElementById('chartjs-tooltip');
			if (!tooltipEl) {
			tooltipEl = document.createElement('div');
			tooltipEl.id = 'chartjs-tooltip';
			tooltipEl.innerHTML = "<table></table>"
			document.body.appendChild(tooltipEl);
			}
			// Hide if no tooltip
			if (tooltip.opacity === 0) {
			tooltipEl.style.opacity = 0;
			return;
			}
			// Set caret Position
			tooltipEl.classList.remove('above', 'below', 'no-transform');
			if (tooltip.yAlign) {
			tooltipEl.classList.add(tooltip.yAlign);
			} else {
			tooltipEl.classList.add('no-transform');
			}
			function getBody(bodyItem) {
			return bodyItem.lines;
			}
			// Set Text
			if (tooltip.body) {
			var titleLines = tooltip.title || [];
			var bodyLines = tooltip.body.map(getBody);
			var innerHtml = '<thead>';
			titleLines.forEach(function(title) {

			innerHtml += '<tr><th>' + title + '</th></tr>';
			});
			innerHtml += '</thead><tbody>';
			bodyLines.forEach(function(body, i) {
			var colors = tooltip.labelColors[i];
			var style = 'background:' + colors.backgroundColor;
			style += '; border-color:' + colors.borderColor;
			style += '; border-width: 2px';
			var span = '<span class="chartjs-tooltip-key" style="' + style + '"></span>';
			innerHtml += '<tr><td>' + span + body + '</td></tr>';
			});
			innerHtml += '</tbody>';
			var tableRoot = tooltipEl.querySelector('table');
			tableRoot.innerHTML = innerHtml;
			}
			var position = this._chart.canvas.getBoundingClientRect();
			// Display, position, and set styles for font
			tooltipEl.style.opacity = 1;
			tooltipEl.style.left = position.left + tooltip.caretX + 'px';
			tooltipEl.style.top = position.top + tooltip.caretY + 'px';
			tooltipEl.style.fontFamily = tooltip._fontFamily;
			tooltipEl.style.fontSize = tooltip.fontSize;
			tooltipEl.style.fontStyle = tooltip._fontStyle;
			tooltipEl.style.padding = tooltip.yPadding + 'px ' + tooltip.xPadding + 'px';
			}
			}
		};

	var color = Chart.helpers.color;
	var color_arr = ['rgb(255, 99, 132)', 'rgb(255, 159, 64)', 'rgb(255, 205, 86)', 
	'rgb(75, 192, 192)', 'rgb(54, 162, 235)', 'rgb(153, 102, 255)', 'rgb(231,233,237)'];

	var env_options;
	for (var key in env_obj) {
		if (env_obj.hasOwnProperty(key)) {
			env_options = {
				type: 'bar',
				data: {
					labels: [key],
					datasets: []
				},
				options: {
					indexAxis: 'y'
				}
			}

			for (var i = 0; i < env_obj[key].data.length; i++) {
				env_options.data.datasets.push({
					axis: 'y',
					label: env_obj.labels[i],
					data: [env_obj[key].data[i]],
					backgroundColor: color(color_arr[i]).alpha(0.8).rgbString(),
					borderColor: color_arr[i]
				});
			}
			//console.log(env_options);
			new Chart(document.getElementById(key), env_options);
		}
	}

	// for (var i = 0; i < obj.length; i++) {
	// 	var target = document.getElementById(obj[i].title);
	// 	var options = {
	// 		type: 'radar', data: { labels: obj[i].labels, datasets: [], options: default_opt }
	// 	}

	// 	for (var x = 0; x < obj[i].datasets.length; x++) {
	// 		options.data.datasets.push({
	// 			label: obj[i].datasets[x].label,
	// 			backgroundColor: color(color_arr[x]).alpha(0.2).rgbString(),
	// 			borderColor: color_arr[x],
	// 			pointBackgroundColor: color_arr[x],
	// 			data: obj[i].datasets[x].data
	// 		});
	// 	}

	// 	new Chart(target, options);
	// }

	document.querySelector("#print").addEventListener("click", function() {
	$('.section-to-print').toggle(); //removes the display:none
    window.print();
    $('.section-to-print').hide(); //brings back the display:none
    
	});

	// var options1 = {
	// 	type: 'bar',
	// 	data: {
	// 		labels: ['jan', 'febb', 'mar', 'apr', 'may', 'june'],
	// 		datasets: [{
	// 			axis: 'y',
	// 			label: 'Dsdas',
	// 			data: [65, 59, 80, 81, 56, 55, 40]
	// 		}]
	// 	},
	// 	options: {
	// 		indexAxis: 'y'
	// 	}
	// }

	// var horizontalBarChart = new Chart(document.getElementById('temp'), options1);


	var view = '';
</script>